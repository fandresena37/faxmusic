class PushCartRecentlyViewed extends window.BAO.CustomElement(){static get requiredElements(){return["carousel","fragmentinjection"]}static get requiredExternalElements(){return["fallbackView"]}constructor(){super(),this.sectionId="async-push-cart-product-card",this.initialised()}initialised(){window.BAO.eventBus.addEventListener(window.BAO.EVENTS.PUSH_CART.CHANGED,this.getCartData.bind(this)),window.BAO.eventBus.addEventListener(window.BAO.EVENTS.PUSH_CART.BEFORE_ADD,this.hideAll.bind(this)),this.fetchProducts(),this.getCartData()}async fetchProducts(){await Promise.allSettled(this.productHandlesWithAppliedLimit.map(productHandle=>fetch(`${window.location.origin}/products/${productHandle}?section_id=${this.sectionId}`).then(res=>res.text()).then(html=>{const parsedHTML=new DOMParser().parseFromString(html,"text/html");parsedHTML.querySelector("[data-mini-card]")&&this.handleFragmentInjection(parsedHTML)}).catch(e=>{console.error(e)}))),this.initaliseCarousel()}async getCartData(){try{const response=await fetch("/cart.js",{method:"GET",headers:{"Content-Type":"application/json"}});if(!response.ok)throw new Error("Failed to fetch cart data");(await response.json()).items.length===0?this.productHandles.length>0?(this.show(),this.externalEls.fallbackView.element.setAttribute("aria-hidden","true")):(this.hide(),this.externalEls.fallbackView.element.setAttribute("aria-hidden","false")):(this.hide(),this.externalEls.fallbackView.element.setAttribute("aria-hidden","true"))}catch(error){console.error("Error:",error)}}initaliseCarousel(){const carousel=this.els.carousel.element.cloneNode({deep:!0});this.els.carousel.element.remove(),this.appendChild(carousel)}handleFragmentInjection(html){const el=document.createElement("li");el.classList.add("psh-EmptyCarousel_ListItem"),el.innerHTML=html.querySelector(`#shopify-section-${this.sectionId}`).innerHTML,this.els.fragmentinjection.element.insertAdjacentElement("beforeend",el)}handleError(message){console.error(message),this.hide()}show(){this.setAttribute("aria-hidden","false")}hide(){this.setAttribute("aria-hidden","true")}hideAll(){this.hide(),this.externalEls.fallbackView.element.setAttribute("aria-hidden","true")}get productHandlesWithAppliedLimit(){return this.productHandles.length>this.limit?this.productHandles.slice(0,this.limit):this.productHandles}get limit(){return Number(this.dataset.limit)}get productHandles(){return JSON.parse(localStorage.getItem("recently-viewed-products"))||[]}}customElements.define("push-cart-recently-viewed",PushCartRecentlyViewed);
//# sourceMappingURL=/cdn/shop/t/50/assets/push-cart-recently-viewed.js.map?v=91477466306508448761709736382
