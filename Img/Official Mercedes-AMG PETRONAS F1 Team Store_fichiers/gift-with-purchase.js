class GiftWithPurchase extends window.BAO.CustomElement(){constructor(){super(),this._loading=!1,this.sections=this.inPushCart?window.BAO.sectionRenderer.pushCartSections:this.onCartPage?window.BAO.sectionRenderer.cartSections:[]}setupListeners(){super.setupListeners(),this.cleanUp&&this.resetCart(),!(!this.variantId||!this.cartAmount)&&(this.handleGiftWithPurchase=this.handleGiftWithPurchase.bind(this),window.BAO.eventBus.addEventListener(window.BAO.EVENTS.PUSH_CART.AFTER_ADD_FROM_FORM,this.handleGiftWithPurchase),window.BAO.eventBus.addEventListener(window.BAO.EVENTS.PUSH_CART.AFTER_UPDATE_REMOVE_ITEM,this.handleGiftWithPurchase),window.BAO.eventBus.addEventListener(window.BAO.EVENTS.PUSH_CART.AFTER_UPDATE_ITEM_QUANTITY,this.handleGiftWithPurchase))}async handleGiftWithPurchase(event){let cartData=event.detail?.state;(!cartData||!cartData.items)&&(cartData=await this.getShopifyCart());const freeGift=this.freeGift(cartData);cartData?.total_price<this.cartAmount&&freeGift?this.removeFreeGift(freeGift):cartData?.total_price>=this.cartAmount&&!freeGift&&this.addFreeGift()}async addFreeGift(){this.loading=!0;const itemToAdd={id:this.variantId,quantity:1,properties:{[this.propertyKey]:"true",[`${this.propertyKey}_cart_amount`]:this.cartAmount}},state=await window.BAO.Cart.addItem(itemToAdd,{sections:this.sections.map(s=>s.section)});this.loading=!1,"sections"in state&&this.renderSections(state.sections)}async removeFreeGift(freeGift){window.BAO.Cart.removeItem(freeGift.key),this.loading=!0;const state=await window.BAO.Cart.removeItem(freeGift.key,{sections:this.sections.map(s=>s.section)});this.loading=!1,"sections"in state&&this.renderSections(state.sections)}async resetCart(){const cartData=await this.getShopifyCart(),freeGift=this.freeGift(cartData);freeGift&&this.removeFreeGift(freeGift)}freeGift(cartData){return cartData.items.find(item=>item.properties?.[this.propertyKey])}get propertyKey(){return"__gift-with-purchase"}get variantId(){return this.dataset?.variantId?parseInt(this.dataset.variantId,10):null}get cleanUp(){return!!this.dataset?.cleanup}get cartAmount(){return this.dataset?.cartAmount?parseInt(this.dataset.cartAmount,10)*Number(window.Shopify.currency.rate):null}get loading(){return this._loading}set loading(val){this._loading=val,this.inPushCart&&(this.pushCart.loading=val),this.setAttribute("aria-busy",val.toString())}async getShopifyCart(){try{return await(await fetch("/cart.js")).json()}catch(error){return console.error(error),null}}get pushCart(){return document.querySelector("push-cart")}get inPushCart(){return this.pushCart!=null}get cart(){return document.querySelector("cart-items")}get onCartPage(){return this.cart!=null}}customElements.get("gift-with-purchase")||customElements.define("gift-with-purchase",GiftWithPurchase);
//# sourceMappingURL=/cdn/shop/t/50/assets/gift-with-purchase.js.map?v=28648356262051736871709133406
